<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ + —Å–æ—Å—Ç–∞–≤—ã (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)</title>
    <style>
        /* –°—Ç–∏–ª–∏ —Ç–µ –∂–µ, —á—Ç–æ –∏ —Ä–∞–Ω–µ–µ (–º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) */
        /* –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ —è –Ω–µ –¥—É–±–ª–∏—Ä—É—é –∏—Ö –∑–¥–µ—Å—å, –Ω–æ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å */
    </style>
</head>
<body>
<div class="container">
    <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ <span>2026</span></h1>
    <div class="sub">–ù–∞–∂–º–∏ –Ω–∞ –∫–æ–º–∞–Ω–¥—É ‚Äî —É–≤–∏–¥–∏—à—å —Å–æ—Å—Ç–∞–≤ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ WebSocket)</div>

    <div class="header-row">
        <div>#</div>
        <div>–ö–æ–º–∞–Ω–¥–∞</div>
        <div>–†–µ–π—Ç–∏–Ω–≥</div>
    </div>

    <div id="teamsList"></div>

    <div class="footer">‚ö° –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</div>
</div>

<script>
    (function() {
        const container = document.getElementById('teamsList');
        let currentTeams = [];

        function closeAllRosters(except = null) {
            document.querySelectorAll('.team-card').forEach(card => {
                if (except && card === except) return;
                const roster = card.querySelector('.roster');
                if (roster) roster.classList.remove('open');
            });
        }

        function renderTeams(teams) {
            container.innerHTML = '';
            const sorted = [...teams].sort((a, b) => b.rating - a.rating);

            sorted.forEach((team, index) => {
                const card = document.createElement('div');
                card.className = 'team-card';

                const row = document.createElement('div');
                row.className = 'team-row';

                const rank = document.createElement('div');
                rank.className = 'rank';
                if (index === 0) rank.textContent = 'ü•á 1';
                else if (index === 1) rank.textContent = 'ü•à 2';
                else if (index === 2) rank.textContent = 'ü•â 3';
                else rank.textContent = index + 1;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'name';
                const initial = team.name.charAt(0).toUpperCase();
                nameDiv.innerHTML = `<span class="icon">${initial}</span>${team.name}`;

                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'rating';
                ratingDiv.innerHTML = `${team.rating.toLocaleString()}<small>pts</small>`;

                row.appendChild(rank);
                row.appendChild(nameDiv);
                row.appendChild(ratingDiv);

                const rosterDiv = document.createElement('div');
                rosterDiv.className = 'roster';

                const rosterTitle = document.createElement('div');
                rosterTitle.className = 'roster-title';
                rosterTitle.textContent = '‚ñ™ –°–æ—Å—Ç–∞–≤';
                rosterDiv.appendChild(rosterTitle);

                const playersScroll = document.createElement('div');
                playersScroll.className = 'players-scroll';

                const playersList = document.createElement('div');
                (team.players || []).forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player';

                    const avatar = document.createElement('div');
                    avatar.className = 'player-avatar';
                    avatar.textContent = player.name.charAt(0).toUpperCase();

                    const info = document.createElement('div');
                    info.className = 'player-info';
                    info.innerHTML = `<span>${player.name}</span><span class="player-role">${player.role}</span>`;

                    playerDiv.appendChild(avatar);
                    playerDiv.appendChild(info);
                    playersList.appendChild(playerDiv);
                });

                playersScroll.appendChild(playersList);
                rosterDiv.appendChild(playersScroll);
                card.appendChild(row);
                card.appendChild(rosterDiv);

                row.addEventListener('click', () => {
                    const isOpen = rosterDiv.classList.contains('open');
                    if (isOpen) {
                        rosterDiv.classList.remove('open');
                    } else {
                        closeAllRosters(card);
                        rosterDiv.classList.add('open');
                    }
                });

                container.appendChild(card);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        fetch('/data')
            .then(response => response.json())
            .then(data => {
                currentTeams = data;
                renderTeams(currentTeams);
            })
            .catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', err);
                container.innerHTML = '<div style="color: red;">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.</div>';
            });

        // WebSocket –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}`;
        const ws = new WebSocket(wsUrl);

        ws.onopen = () => console.log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        ws.onmessage = (event) => {
            try {
                const message = JSON.parse(event.data);
                if (message.type === 'update') {
                    currentTeams = message.data;
                    renderTeams(currentTeams);
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', e);
            }
        };
        ws.onerror = (error) => console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
        ws.onclose = () => console.log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
    })();
</script>
</body>
</html>