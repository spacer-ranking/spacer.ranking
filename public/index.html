<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ + —Å–æ—Å—Ç–∞–≤—ã (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            background: #0d1117;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        .container {
            max-width: 700px;
            width: 100%;
            background: #161c24;
            border-radius: 30px;
            padding: 24px;
            box-shadow: 0 20px 35px rgba(0, 0, 0, 0.7), 0 0 0 1px rgba(255, 255, 255, 0.05);
        }
        h1 {
            font-size: 28px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        h1 span {
            background: #2e3a4a;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 14px;
            font-weight: 400;
            color: #b0c8ff;
        }
        .sub {
            color: #8f9bb5;
            margin-bottom: 20px;
            border-bottom: 1px solid #232e3c;
            padding-bottom: 12px;
        }
        .header-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px;
            color: #8896b0;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            padding: 0 12px 8px 12px;
        }
        .team-card {
            background: #1e2732;
            border-radius: 24px;
            margin-bottom: 8px;
            border: 1px solid #2b3645;
            transition: 0.15s;
        }
        .team-card:hover {
            border-color: #4f6f9f;
        }
        .team-row {
            display: grid;
            grid-template-columns: 60px 1fr 100px;
            align-items: center;
            padding: 14px 16px;
            cursor: pointer;
            user-select: none;
        }
        .rank {
            font-weight: 700;
            font-size: 18px;
            color: #ffb347;
            padding-left: 8px;
        }
        .name {
            font-weight: 600;
            font-size: 18px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .icon {
            width: 34px;
            height: 34px;
            background: linear-gradient(145deg, #2f4b7c, #1f3557);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #ffb85c;
            text-transform: uppercase;
        }
        .rating {
            font-weight: 700;
            font-size: 18px;
            color: #b0d0ff;
            text-align: right;
            padding-right: 12px;
        }
        .rating small {
            font-size: 12px;
            color: #6d83a4;
            margin-left: 4px;
        }
        .roster {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.35s ease, opacity 0.25s ease, padding 0.25s;
            background: #131b24;
            border-radius: 0 0 24px 24px;
            padding: 0 16px;
        }
        .roster.open {
            max-height: 450px;
            opacity: 1;
            padding: 16px 16px 20px 16px;
            border-top: 1px solid #2d4055;
        }
        .roster-title {
            color: #a7c0e0;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }
        .players-scroll {
            max-height: 220px;
            overflow-y: auto;
            padding-right: 4px;
            scrollbar-width: thin;
            scrollbar-color: #4f6f9f #1d2a36;
        }
        .players-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .players-scroll::-webkit-scrollbar-track {
            background: #1d2a36;
            border-radius: 10px;
        }
        .players-scroll::-webkit-scrollbar-thumb {
            background: #4f6f9f;
            border-radius: 10px;
        }
        .players-scroll::-webkit-scrollbar-thumb:hover {
            background: #6b8fbf;
        }
        .player {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: #1d2a36;
            border-radius: 18px;
            margin-bottom: 8px;
        }
        .player-avatar {
            width: 30px;
            height: 30px;
            background: #3d5466;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #fff;
        }
        .player-info {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
        }
        .player-role {
            background: #2b3e4e;
            padding: 4px 10px;
            border-radius: 30px;
            font-size: 13px;
            color: #b8d4ff;
        }
        .footer {
            margin-top: 20px;
            color: #5a6f8a;
            font-size: 13px;
            text-align: center;
        }
        @media (max-width: 500px) {
            .header-row, .team-row {
                grid-template-columns: 50px 1fr 80px;
                padding: 12px 10px;
            }
            .name { font-size: 16px; }
            .players-scroll {
                max-height: 180px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ <span>2026</span></h1>
    <div class="sub">–ù–∞–∂–º–∏ –Ω–∞ –∫–æ–º–∞–Ω–¥—É ‚Äî —É–≤–∏–¥–∏—à—å —Å–æ—Å—Ç–∞–≤ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ WebSocket)</div>

    <div class="header-row">
        <div>#</div>
        <div>–ö–æ–º–∞–Ω–¥–∞</div>
        <div>–†–µ–π—Ç–∏–Ω–≥</div>
    </div>

    <div id="teamsList"></div>

    <div class="footer">‚ö° –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</div>
</div>

<script>
    (function() {
        const container = document.getElementById('teamsList');
        let currentTeams = [];

        function closeAllRosters(except = null) {
            document.querySelectorAll('.team-card').forEach(card => {
                if (except && card === except) return;
                const roster = card.querySelector('.roster');
                if (roster) roster.classList.remove('open');
            });
        }

        function renderTeams(teams) {
            container.innerHTML = '';
            const sorted = [...teams].sort((a, b) => b.rating - a.rating);

            sorted.forEach((team, index) => {
                const card = document.createElement('div');
                card.className = 'team-card';

                const row = document.createElement('div');
                row.className = 'team-row';

                const rank = document.createElement('div');
                rank.className = 'rank';
                if (index === 0) rank.textContent = 'ü•á 1';
                else if (index === 1) rank.textContent = 'ü•à 2';
                else if (index === 2) rank.textContent = 'ü•â 3';
                else rank.textContent = index + 1;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'name';
                const initial = team.name.charAt(0).toUpperCase();
                nameDiv.innerHTML = `<span class="icon">${initial}</span>${team.name}`;

                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'rating';
                ratingDiv.innerHTML = `${team.rating.toLocaleString()}<small>pts</small>`;

                row.appendChild(rank);
                row.appendChild(nameDiv);
                row.appendChild(ratingDiv);

                const rosterDiv = document.createElement('div');
                rosterDiv.className = 'roster';

                const rosterTitle = document.createElement('div');
                rosterTitle.className = 'roster-title';
                rosterTitle.textContent = '‚ñ™ –°–æ—Å—Ç–∞–≤';
                rosterDiv.appendChild(rosterTitle);

                const playersScroll = document.createElement('div');
                playersScroll.className = 'players-scroll';

                const playersList = document.createElement('div');
                (team.players || []).forEach(player => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player';

                    const avatar = document.createElement('div');
                    avatar.className = 'player-avatar';
                    avatar.textContent = player.name.charAt(0).toUpperCase();

                    const info = document.createElement('div');
                    info.className = 'player-info';
                    info.innerHTML = `<span>${player.name}</span><span class="player-role">${player.role}</span>`;

                    playerDiv.appendChild(avatar);
                    playerDiv.appendChild(info);
                    playersList.appendChild(playerDiv);
                });

                playersScroll.appendChild(playersList);
                rosterDiv.appendChild(playersScroll);
                card.appendChild(row);
                card.appendChild(rosterDiv);

                row.addEventListener('click', () => {
                    const isOpen = rosterDiv.classList.contains('open');
                    if (isOpen) {
                        rosterDiv.classList.remove('open');
                    } else {
                        closeAllRosters(card);
                        rosterDiv.classList.add('open');
                    }
                });

                container.appendChild(card);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        fetch('/data')
            .then(response => response.json())
            .then(data => {
                currentTeams = data;
                renderTeams(currentTeams);
            })
            .catch(err => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', err);
                container.innerHTML = '<div style="color: red;">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.</div>';
            });

        // WebSocket –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}`;
        const ws = new WebSocket(wsUrl);

        ws.onopen = () => console.log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        ws.onmessage = (event) => {
            try {
                const message = JSON.parse(event.data);
                if (message.type === 'update') {
                    currentTeams = message.data;
                    renderTeams(currentTeams);
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', e);
            }
        };
        ws.onerror = (error) => console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
        ws.onclose = () => console.log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
    })();
</script>
</body>
</html>